<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../../fonts/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../fonts/iconfont2.css" />
		<link rel="stylesheet" type="text/css" href="../../fonts/system/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../../js/layui/css/layui.css" />
		<style>
			[v-cloak] {
				visibility: hidden;
				display:none !important;
			}
			.mui-bar-tab .mui-tab-item.mui-active {
				color: #3893D9;
			}
			/* 左侧按钮 */
			.tab-btn-left{
				padding: 30px 0 15px;
				border-bottom: 1px solid rgba(210,207,200,.9);
			}
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active{
				border-bottom: 0px;
			}
			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active p{
				color: #3893D9;
			}
			
			/* 右侧视图 */
			.mui-control-content{
				height: calc(100vh - 55px );
				padding:20px 0 0 15px;
			}
			
			/* 左侧视图 */
			.mui-segmented-control-tab.mui-segmented-control-inverted-tab{
				border-right: 1px solid rgba(210,207,200,.9);
				height: calc(100vh - 45px);
			}
			.line{
				background-color: #3893D9;
				margin-bottom: 0.3125rem;
				height: 0.125rem;
			}
			
			/* 栅格 宽度修改 */
			.mui-col-sm-1 {
			    width: 10.33333333% !important;
			}
			
			.mui-col-sm-11 {
			    width: 89.66666667% !important;
			}
			
			.content-body{
				padding: 0.9375rem 0 0 0.9375rem;
			}
			
			h4 {
				color: #c3865c;
			}
			
			/* 身份证照片框样式 */
			.card-img{
				border: 1px solid rgba(210,207,200,.9);
				width:171px;
				height: 240px;
			}
			.card-text{
				display: block;
				margin: 63% 27% 0;
				width: 80px;
				font-size: 15px;
				color: grey;
			}
			/* 读证样式 */
			.scan{
				border: 2px solid #C0726C;
				border-radius: 50%;
				padding:27px 17px;
				width: 75px;
				height: 75px;
				color:#C0726C;font-size:1.125rem;
				font-weight: 600;
				margin:15px 0 0 25%;
			}
			
			/* 输入框样式和间距修改 */
			.mui-input-row label{
				width: 28%;
				font-weight: 600;
				text-align: right;
			}
			.mui-input-row label~input, .mui-input-row label~select, .mui-input-row label~textarea{
				border: 1px solid rgba(210,207,200,.8);
				width: 72%;
				float: left;
			}
			
			.mui-input-row-bottom label{
				width: 22%;
				font-weight: 600;
				text-align: right;
				padding: 11px 5px;
			} 
			.mui-input-row-bottom label~input, .mui-input-row-bottom label~select, .mui-input-row-bottom label~textarea{
				border: 1px solid rgba(210,207,200,.8);
				width: 70%;
				float: left;
			}
			
			.mui-input-row-bottom-lar label{
				width: 28%;
				font-weight: 600;
				text-align: right;
				padding: 11px 5px;
			} 
			.mui-input-row-bottom-lar label~input, .mui-input-row-bottom-lar label~select, .mui-input-row-bottom-lar label~textarea{
				border: 1px solid rgba(210,207,200,.8);
				width: 70%;
				float: left;
			}
			
			/* 被访人信息 slider 样式修改 */
			.mui-slider .mui-segmented-control.mui-segmented-control-inverted~.mui-slider-group .mui-slider-item{
				border-bottom: 0;
			}
			.bfr-bottom{
				width: 220px !important;
				font-weight: 600;
			}
			/* 表单间距 */
			.mui-input-row{
				margin-top: 8px;
			}
			.mui-input-row-bottom,.mui-input-row-bottom-lar{
				margin-top: 8px;
				padding-right: 3px;
			}
			
			/* 底部按钮样式 */
			.mui-btn-outlined{
				width: 140px;
				margin: 0 10px;
				font-size: 18px;
				font-weight: 600;
				line-height: 2;
			}
			
			/* 分页样式 */
			.layui-laypage a, .layui-laypage span {
			    height: 42px !important;
				padding: 0 18px;
			    line-height: 42px !important;
			}
			
			/* 表头样式 */
			.layui-table thead tr{
				background-color: #3893D9;
				color: #FAFAFA;
			}
		</style> 
	</head>
	<body>
		<header class="mui-bar mui-bar-nav" id="tempHead">
			<h1 v-cloak class="mui-title" >{{headTitle}}</h1>
			<a @click="quit()" class="mui-pull-right" style="font-size: 1rem;margin-top: 0px;">注销</a>
		</header>
		<div v-cloak class="mui-content" style="margin-top: 0px;background: white;" id="contentData">
			<div class="mui-row">
				<div class="mui-col-sm-1">
						<div id="segmentedControl" class="mui-segmented-control mui-segmented-control-inverted  mui-segmented-control-tab mui-segmented-control-inverted-tab">
							<div class="mui-col-sm-12 tab-btn-left"><a @tap="tabClick('in')" class="mui-control-item mui-active" href="#item1"><img :src="inActive?'../../img/home/ic_sign_in_active.png':'../../img/home/ic_sign_in.png'" style="width: 45px;height: 45px;"><p>来访登记</p></a></div>
							<div class="mui-col-sm-12 tab-btn-left"><a @tap="tabClick('select')" class="mui-control-item" href="#item2"><img :src="selectActive?'../../img/home/ic_sign_query_active.png':'../../img/home/ic_sign_query.png'" style="width: 45px;height: 45px;"><p>访客查询</p></a></div>
							<div class="mui-col-sm-12 tab-btn-left"><a @tap="tabClick('out')" class="mui-control-item" href="#item3"><img :src="outActive?'../../img/home/ic_sign_off_active.png':'../../img/home/ic_sign_off.png'" style="width: 45px;height: 45px;"><p>访客签离</p></a></div>
						</div>
				</div>
				<div class="mui-col-sm-11">
					<div>
						<div id="item1" class="mui-control-content mui-active">
							<h4>访客信息</h4>
							<div class="line"></div>
							<div class="mui-row" style="margin-top: 1rem;">
								<div class="mui-col-sm-2">
									<img v-if="IDCardImg" class="card-img" src="../../img/home/idcard.jpg">
									<div v-else class="card-img" ><span class="card-text">身份证照片</span></div>
									<div class="scan" @tap="scan()">读证</div>
								</div>
								<div class="mui-col-sm-10" style="margin-left: -25px;margin-top: -10px;">
									<div class="mui-row" >
										<template v-for="item in 12">
											<div class="mui-col-sm-6">
												<div class="mui-input-row">
													<label><span style="color: #D26A60;">*</span>出生日期：</label>
													<input  type="text" placeholder="普通输入框">
												</div>
											</div>
										</template>
										<div class="mui-col-sm-6">
											<div class="mui-input-row">
												<label>备注：</label>
												<input  type="text" placeholder="普通输入框">
											</div>
										</div>
									</div>
								</div>
							</div>
							<div style="margin-top: 1.5rem;"></div>
							<h4>被访人信息</h4>
							<div class="line"></div>
							<div class="mui-row" style="margin-top: 1rem;">
								<div id="slider" class="mui-slider">
									<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted bfr-bottom">
											<a class="mui-control-item mui-active" href="#item1mobile">教职工</a>
											<a class="mui-control-item" href="#item2mobile">学生</a>
									</div>
									<div class="mui-slider-group">
										<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
											<div class="mui-row">
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom">
														<label>部门：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom">
														<label><span style="color: #D26A60;">*</span>姓名：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
											</div>
										</div>
										<div id="item2mobile" class="mui-slider-item mui-control-content">
											<div class="mui-row">
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom">
														<label>年级：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom">
														<label>班级：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom">
														<label><span style="color: #D26A60;">*</span>姓名：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
												<div class="mui-col-sm-3">
													<div class="mui-input-row mui-input-row-bottom-lar">
														<label><span style="color: #D26A60;">*</span>班主任：</label>
														<input  type="text" placeholder="普通输入框">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="mui-row" style="margin-top: 2rem;text-align: center;">
								<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined">
									保存
								</button>
								<button type="button" class="mui-btn mui-btn-success mui-btn-outlined">
									保存并打印
								</button>
								<button type="button" class="mui-btn mui-btn-outlined">
									取消
								</button>
							</div>
						</div>
						<div id="item2" class="mui-control-content">
							 <div class="mui-row">
								<div class="mui-input-row mui-input-row-bottom">
									<label style="width: 80px;">关键字：</label>
									<input style="width: 120px;margin-right: 5px;" type="text" placeholder="普通输入框">
									<label style="width: 90px;">是否离开：</label>
									<input style="width: 120px;margin-right: 5px;" type="text" placeholder="普通输入框">
									<label style="width: 80px;">被仿人：</label>
									<input style="width: 120px;margin-right: 5px;" type="text" placeholder="普通输入框">
									<label style="width: 90px;">进入时间：</label>
									<input style="width: 120px;margin-right: 5px;" type="text" placeholder="普通输入框">
									<label style="width: 40px;">至：</label>
									<input style="width: 120px;margin-right: 5px;" type="text" placeholder="普通输入框">
									<button type="button" class="mui-btn mui-btn-outlined" style="font-size: 15px;color: #3893D9;width: 80px;">查询</button>
								</div>
							 </div>
							 <div class="mui-row" style="margin-right: 15px;">
							 	 <table class="layui-hide" id="demo"></table>
								 <div id="pageLAY" style="text-align: right;"></div>
							 </div>
						</div>
						<div id="item3" class="mui-control-content">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									第三个选项卡子项-1
								</li>
								<li class="mui-table-view-cell">
									第三个选项卡子项-2
								</li>
								<li class="mui-table-view-cell">
									第三个选项卡子项-3
								</li>
								<li class="mui-table-view-cell">
									第三个选项卡子项-1
								</li>
								<li class="mui-table-view-cell">
									第三个选项卡子项-2
								</li>
								<li class="mui-table-view-cell">
									第三个选项卡子项-3
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>	 
		<script src="../../js/utils/storageKeyName.js"></script>
		<script src="../../js/utils/mui.min.js"></script>
		<script src="../../js/utils/vue.js"></script>
		<script src="../../js/utils/store.js"></script>
		<script src="../../js/utils/events.js"></script>
		<!-- <script src="../../js/utils/vconsole.min.js"></script> -->
		<script src="../../js/utils/utils.js"></script>
		<!-- <script src="../../js/libs/jquery.js"></script> -->
		<script src="../../js/layui/layui.js"></script>
		<script type="text/javascript" charset="utf-8">
			
			// plus.pushPermission.gotoSetting(function(){
			// 	alert('Success')
			// },function(){
			// 	alert('fail')
			// })
			
			
			mui.init();
			var personal = store.get(window.storageKeyName.PERSONALINFO);
			
			var tempHead = new Vue({
				el: "#tempHead",
				data: {
					headTitle: '访客系统',
				},
				methods:{
					quit:function(){
						// plus.runtime.quit();
						quit();
					}
				}
			});
			
			var contentData = new Vue({
				el: "#contentData",
				data: {
					inActive:true,//来访登记激活
					selectActive:false,//来访查询激活
					outActive:false,//访客签离激活
					type:"in",//默认显示的tab类型
					IDCardImg:'1',//身份证照片
				},
				methods:{
					tabClick:function(type){//tab按钮点击
						if(this.type===type){}else{
							this.type=type
							this.inActive=false
							this.selectActive=false
							this.outActive=false
							if(type==='in'){
								this.inActive=true
							}else if(type==='select'){
								this.selectActive=true
								getSelectDataTable();
							}else if(type==='out'){
								this.outActive=true
							}
						}
					},
					scan:function(){//读证按钮点击
						mui.toast("TODO 原生读卡")
					},
				}
			});
			
			mui.plusReady(function() {
				var tempMenu = store.get(window.storageKeyName.MENULIST);
				var personal = store.get(window.storageKeyName.PERSONALINFO);
				
				mui('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration: 0.0009
				});
				//安卓的连续点击两次退出程序
				var backButtonPress = 0;
				//重写返回键
				mui.back = function(event) {
					backButtonPress++;
					if (backButtonPress > 1) {
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast('再按一次退出应用');
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
			});
			
			//获取表格数据——访客查询
			function getSelectDataTable(){
				layui.use(['laypage','table'], function(){
				  var laypage = layui.laypage;
				  var table = layui.table;
				  initSelectTable(table,'',[]);
				  //执行一个laypage实例
				  laypage.render({
				    elem: 'pageLAY' //注意，这里的 test1 是 ID，不用加 # 号
				    ,count: 150  //TODO
					,limit:11
					,theme: '#3893D9'
					,first: '首页'
					,last: '尾页'
					 ,jump: function(obj, first){
						 console.log(first); 
					    console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
					    console.log(obj.limit); //得到每页显示的条数
						events.showWaiting()
						//TODO 模拟请求数据
						setTimeout(function(){
							var da=[];
							var datassss1=[{"id":"张三三1","username":"66","sex":"女","city":"城市-0","sign":"签名-0","experience":'2021年5月10日 15:40:06',"logins":24,"wealth":82830700,"classify":"2021年5月10日 15:40:21","score":57}]
							var datassss2=[{"id":"张三三2","username":"66","sex":"女","city":"城市-0","sign":"签名-0","experience":'2021年5月10日 15:40:06',"logins":24,"wealth":82830700,"classify":"2021年5月10日 15:40:21","score":57}]
							var datassss3=[{"id":"张三三3","username":"66","sex":"女","city":"城市-0","sign":"签名-0","experience":'2021年5月10日 15:40:06',"logins":24,"wealth":82830700,"classify":"2021年5月10日 15:40:21","score":57}]
							if(obj.curr==1){
								da=datassss1
							}
							if(obj.curr==2){
								da=datassss2
							}
							if(obj.curr==3){
								da=datassss3
							}
							initSelectTable(table,'1',da);
						},1000)
					  }
				  });
				});
			}
			//初始化表格——访客查询
			function initSelectTable(table,ty,da){
				var don=''
				if(ty){
					don=function(res, curr, count){events.closeWaiting();}
				}
				table.render({
					elem: '#demo'
					,height: 'full-200'
					,cellMinWidth: 90
					,limit:11
					,cols: [[ //表头
					  {field: 'id', title: '姓名', rowspan: 2}
					  ,{field: 'username', title: '随行人数',  rowspan: 2}
					  ,{field: 'sex', title: '访问事由', rowspan: 2 }
					  ,{align: 'center', title: '被访教职工', colspan:2}
					  ,{align: 'center', title: '被仿学生', colspan:3}
					  ,{field: 'experience', title: '进入时间', rowspan: 2 }
					  ,{field: 'score', title: '是否离开',  rowspan: 2}
					  ,{field: 'classify', title: '签离时间', rowspan: 2}
					  ,{field: 'wealth', title: '操作',  rowspan: 2}
					  ]
					  ,[
					   {field: 'city', title: '部门',}
					   ,{field: 'sign', title: '姓名',}
					   ,{field: 'experience', title: '年级班级',}
					   ,{field: 'classify', title: '学生',}
					   ,{field: 'wealth', title: '班主任',}
					   ]]
					   ,done:don
					,data:da
				  });
			}
			
			//获取表格数据
			function initOutDataTable(){
			}
			
			//注销登录
			function quit(){
				store.remove(window.storageKeyName.PERSONALINFO);
				//获取所有已打开的webview 实例————重新打开login.html————循环关闭页面
				plus.webview.open('../../html/login/loginIndex.html', '../../html/login/loginIndex.html', {
					statusbar: {
						background: "#3893D9"
					}
				},"fade-in",10);
				setTimeout(function(){
					var curr = plus.webview.currentWebview();
					var wvs = plus.webview.all();
					try{
						if(wvs){
							for (var i = 0, len = wvs.length; i < len; i++) {
								//关闭除login 页面外的其他页面
								if (wvs[i].getURL()!=null && wvs[i].getURL()!=undefined){
									if(wvs[i].getURL().indexOf('loginIndex.html')!=-1) {
										continue;
									}else{
										plus.webview.close(wvs[i]);
									}
								}
							}
						}
					}catch(e){
						console.log("这有一个退出异常！！！！！！！！！！: " + JSON.stringify(e));
					} 
					curr.close();
				},600)
			}
		</script>
	</body>

</html>
