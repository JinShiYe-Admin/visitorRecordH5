<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>切换目录</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../js/swiper/swiper-bundle.min.css">
		<link href="http://www.jq22.com/jquery/bootstrap-3.3.4.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../css/btlearn/common.css"/>
		<style type="text/css">
			.catalogs{
				margin-top: 6px;
			}
			
			.names{ 
				padding-left: 15px;
				width: 70px;
				position: relative;
				background: white;
				z-index: 2;
				top: 14px;
			}
			.names:first-child{
				top: 19px;
			}
			/*滑动菜单行高*/
			.swiper-slide{
				height:30px;
			}
			
			.swiper-container{
				margin-left: 70px !important;
			}
			.fontcolor{
				color: #00CFBD;
			}
			
			/*可能是多级菜单的样式*/
			.mui-bar-nav {
				z-index: 999;
			}
			#header:after {
				content: "";
				position: absolute;
				z-index: -1;
				left: 0;
			    right: 0;
			    top: 0;
			    bottom: 0;
			}
			.mui-bar-tab {
				height: 1rem;
				background-color: #F9F9F4;
			}
			.mui-bar-tab .mui-tab-item {
				height: 1rem;
			}
			.mui-bar-tab .mui-tab-item .mui-icon {
				font-size: 0.44rem;
				top: 0;
    			margin-bottom: 0.04rem;
			}
			.mui-bar-tab .mui-tab-item .mui-icon~.mui-tab-label {
				font-size: 0.24rem;
			}
			.kn-menu .label-wrapper {
				padding: 0.3rem 1rem 0.3rem 0.2rem;
				border-bottom: 1px solid #ECECEC;
				position: relative;
			}
			.kn-menu .label-icon {
				margin-right: -0.3rem;
				vertical-align: middle;
			}
			.kn-menu .label-name {
				vertical-align: middle;
			}
			.kn-menu .label-icon + .label-name {
				padding-left: 0.4rem;
			}
			.label-wrapper .done-box {
				display: inline-block;
				width: 0.32rem;
				height: 0.32rem;
				border: 1px solid #4AC058;
				border-radius: 2px;
				text-align: center;
				line-height: 0.22rem;
				position: absolute;
				right: 0.6rem;
				top: 50%;
				margin-top: -0.16rem;
			}
			.options-pannel {
				position: absolute;
				left: 0;
				top: 100%;
				min-width: 100%;
				background-color: #FFFFFF;
				margin-right: -0.26rem;
				padding: 0.5rem 0.2rem 0.4rem;
				color: #222222;
				z-index: -1;
			}
			.options-pannel label input[type="radio"] {
				display: none;
			}
			.options-pannel .radio-wrap {
				display: block;
				float: left;
				width: 1.58rem;
				height: 0.63rem;
				line-height: 0.63rem;
				margin-right: 0.26rem;
				margin-bottom: 0.2rem;
				text-align: center;
			}
			.options-pannel label {
				display: block;
				border: 1px solid #D0D0D0;
				border-radius: 0.05rem;
				background-color: #F5F5F5;
				font-size: 0.24rem;
			}
			.options-pannel label.selected {
				background-color: #3C9DFB;
				color: #FFFFFF;
				border-color: #3C9DFB;
			}
			.als-title {
				padding: 0.4rem 0.2rem 0;
				font-size: 0.3rem;
				color: #222222;
			}
			.als-title:after {
				display: block;
				content: "";
				border-bottom: 1px solid #DDDDDD;
				padding-bottom: 0.4rem;
			}
			.als-list:before {
				display: none;
			}
			.als-list li {
				display: flex;
				justify-content: space-between;
				padding: 0.3rem 0.6rem 0.3rem 0.2rem;
				line-height: 0.64rem;
			}
			.als-list li:first-child {
				padding-bottom: 0.15rem;
			}
			ul.als-list li .sub {
				padding-left: 1.1rem;
				vertical-align: middle;
			}
			ul.als-list li .sub .label {
				display: inline-block;
				text-align: center;
				border: 1px solid #25AE38;
				color: #25AE38;
				border-radius: 4px;
				vertical-align: middle;
				margin-top: -3px;
				width: 1.2rem;
				height: .64rem;
				line-height: .64rem;
				font-size: 150%;
				margin-left: -1.6rem;
				margin-right: 0.4rem;
				transform: scale(0.5);
				transform-origin: 150% 50%;
			}
			ul.als-list li .sub .label.bad {
				color: #DB4848;
				border-color: #DB4848;
			}
			ul.als-list li .score {
				width: 30%;
				text-align: center;
			}
			.als-list li .sub {
				width: 35%;
			}
			.als-list li .times {
				width: 28%;
				text-align: center;
			}
			#subRadar {
				min-height: 205px;
				max-height: 440px;
				margin-bottom: .6rem;
			}
			#analysis {
				max-height: 100%;
				overflow-y: auto;
			}
			
			.swiper-slide {
				width: 20.6%;  
			} 
		</style>
	</head>

	<body style="background: white;">
		<header class="mui-bar mui-bar-nav" style="background-color:#00CFBD;height: 44px;">
			<a  class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white"></a>
			<h1 class="mui-title" style="color: white;">切换目录</h1>
		</header>
		<div class="mui-content" style="background: white;">
			<div id="catalogData">
				<!--顶部滑动菜单-->
				<div class="names" v-cloak>学段：</div>
				<div class="swiper-container catalogs" v-cloak id="xueduan">
					<div class="swiper-wrapper">
						<div class="swiper-slide" :class="xd.ischeck==1?'fontcolor':''" v-for="(xd,index) in resPerArray" @tap="catalogItemClick(resPerArray,xd,'xd')">{{xd.per_name}}</div>
					</div>
				</div>
				<div class="names" v-cloak>科目：</div>
				<div class="swiper-container" style="margin-top: 1px;" v-cloak id="kemu">
					<div class="swiper-wrapper">
						<div class="swiper-slide" :class="km.ischeck==1?'fontcolor':''" v-for="(km,index) in resSubArray"  @tap="catalogItemClick(resSubArray,km,'km')">{{km.sub_name}}</div>
					</div>
				</div>
				<div class="names" v-cloak>教版：</div>
                <div class="swiper-container" style="margin-top: 1px;" v-cloak id="jiaoban">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" :class="jb.ischeck==1?'fontcolor':''" v-for="(jb,index) in resMaterArray"  @tap="catalogItemClick(resMaterArray,jb,'jb')">{{jb.mater_name}}</div>
                    </div>
                </div> 
				<div class="names" v-cloak>分册：</div>
				<div class="swiper-container" style="margin-top: 1px;" v-cloak id="fence">
					<div class="swiper-wrapper">
						<div class="swiper-slide" :class="fc.ischeck==1?'fontcolor':''" v-for="(fc,index) in resFascArray"  @tap="catalogItemClick(resFascArray,fc,'fc')">{{fc.fasc_name}}</div>
					</div>
				</div>
				<!--底部目录列表-->
				<div id="test-menu" class="mui-control-content mui-active">
					<div id="testMenu" class="mui-content vue-tree">
						<div class="kn-menu" v-cloak>
							<tree-menu v-for="(model, i) in resCatalogsArray" :model="model" :key="i" :depth="0" @node-click="selectNode"></tree-menu>
							<p v-if="!resCatalogsArray.length"  style="padding: 0.3rem;margin-top: 20px;">暂无目录</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../../js/utils/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/vue.js"></script>
		<script type="text/javascript" src="../../js/swiper/swiper-bundle.js"></script>
		<script type="text/javascript" src="../../js/zhixueziyuan/common.js"></script>
		<!--加密-->
		<script src="../../js/libs/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/encryption/RSAEncrypt.js"></script>
		<script src='../../js/libs/crypto-js/require.js'></script>
		<script src='../../js/libs/encryption/signHmacSHA1.js'></script>
		<script src='../../js/libs/jquery.js'></script>
		<script src='../../js/libs/encryption/sortSign.js'></script>
		<!---->
		<script type="text/javascript" src="../../js/utils/vconsole.min.js"></script>
		<script src="../../js/utils/storageKeyName.js"></script>
		<script src="../../js/utils/store.js"></script>
		<script src="../../js/utils/utils.js"></script>
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/muiPicker/mui.picker.js"></script>
		<script src="../../js/muiPicker/mui.poppicker.js"></script>
		<script src="../../js/utils/publicProtocol.js"></script>
		
		<script type="text/javascript">
			
			mui.init();
			//获取个人信息
			var personal = store.get(window.storageKeyName.PERSONALINFO);
			console.log('personal:' + JSON.stringify(personal));
			var curPage = {};
			mui.plusReady(function() {
				curPage = utils.getDataFromUrl(window.location.href);
				console.log('2222:' + JSON.stringify(curPage));
				// 查询学段
				getResPer();
			});
			var catalogData=new Vue({
				el:'#catalogData',
				data:{
					resPerArray:[],//学段列表
					resPerModel: {}, //当前学段
					resSubArray:[],//科目列表
					resSubModel: {}, //当前科目
					resMaterArray:[],//教版列表
					resMaterModel: {}, //当前教版
					resFascArray:[],//分册列表
					resFascModel: {}, //当前分册
					resCatalogsArray: [],//目录列表
				},
				methods:{
					catalogItemClick:function(parent,item,lx){
						if(item.ischeck==0){
							for(var i=0;i<parent.length;i++){
								var child=parent[i];
								child.ischeck=0;
							}
							item.ischeck=1;
							//重新查询目录
							if(lx=='xd'){
								catalogData.resPerModel = item;
								// 查询科目
								getResSub();
							}else if(lx=='km'){
								catalogData.resSubModel = item;
								// 查询教版
								getResMater();
							}else if(lx=='jb'){
								catalogData.resMaterModel = item;
								// 查询分册
								getResFasc();
							}else if(lx=='fc'){
								catalogData.resFascModel = item;
								// 查询目录
								getResCatalogs();
							}
						}
					},
					selectNode: function(model) {
						console.log(JSON.stringify(model));
						var btnArray = ['否', '是'];
						mui.confirm('确定切换到当前章节？', '提醒', btnArray, function(e) {
							if (e.index == 1) {
								var newObj=[];
								newObj.push(model);
								newObj.push(catalogData.resPerModel);
								newObj.push(catalogData.resSubModel);
								//通知上一页，把参数传过去
								mui.fire(plus.webview.currentWebview().opener(), 'selectCatalog', newObj);
								mui.back();
							}  
						})
					}
				},
				mounted: function () {
					//初始化滑动菜单
					var swiper = new Swiper('.swiper-container', {
					  	slidesPerView: 5,//菜单可见个数
					  	spaceBetween: 10,//间隔
					  	freeMode: true,//自由滑动模式
					  	noSwiping : true,//禁止滑动
					});
		        },   
		        computed: {
			      getKm: function() {
			        return this.resSubArray;
			      }
			    },
			    watch: {
			      getKm: function(val) {
			      	//初始化滑动菜单，防止数据请求慢，导致的初始化失败问题
			      	setTimeout(function(){
			      		var swiper = new Swiper('.swiper-container', {
						  	slidesPerView: 5,//菜单可见个数
						  	spaceBetween: 10,//间隔
						  	freeMode: true,//自由滑动模式
						  	noSwiping : true,//禁止滑动
						});
			      	},500);
			      }
			    }
			});
			
			// 查询学段
			function getResPer() {
				var tempData = {
					index_code: curPage.access
				}
				postDataEncry(window.storageKeyName.INTERFACE_ZXKT + '/pub/resPer', {}, tempData, 2, function(data) {
					events.closeWaiting();
					if (data.code == 0) {
						if (data.data.list && data.data.list.length > 0) {
							for(var i = 0; i < data.data.list.length; i++){
								var tempM = data.data.list[i];
								if (i==0) {
									tempM.ischeck = 1;
								} else{
									tempM.ischeck = 0;
								}
							}
							catalogData.resPerArray = [].concat(data.data.list);
							catalogData.resPerModel = data.data.list[0];
							// 查询科目
							getResSub();
						} else {
							catalogData.resPerArray = [].concat([]);
							catalogData.resSubArray = [].concat([]);
							catalogData.resMaterArray = [].concat([]);
							catalogData.resFascArray = [].concat([]);
							catalogData.resCatalogsArray = [].concat([]);
							mui.toast('暂无学段');
						}
					} else {
						mui.toast(data.msg);
					}
				});
			}
			
			// 查询科目
			function getResSub() {
				var tempData = {
					per_code: catalogData.resPerModel.per_code, //学段代码
					index_code: curPage.access
				}
				postDataEncry(window.storageKeyName.INTERFACE_ZXKT + '/pub/resSub', {}, tempData, 2, function(data) {
					events.closeWaiting();
					if (data.code == 0) {
						if (data.data.list && data.data.list.length > 0) {
							for(var i = 0; i < data.data.list.length; i++){
								var tempM = data.data.list[i];
								if (i==0) {
									tempM.ischeck = 1;
								} else{
									tempM.ischeck = 0;
								}
							}
							catalogData.resSubArray = [].concat(data.data.list);
							catalogData.resSubModel = data.data.list[0];
							// 查询教版
							getResMater();
						} else {
							catalogData.resSubArray = [].concat([]);
							catalogData.resMaterArray = [].concat([]);
							catalogData.resFascArray = [].concat([]);
							catalogData.resCatalogsArray = [].concat([]);
							mui.toast('暂无科目');
						}
					} else {
						mui.toast(data.msg);
					}
				});
			}
			
			// 查询教版
			function getResMater() {
				var tempData = {
					per_code: catalogData.resPerModel.per_code, //学段代码
					sub_code: catalogData.resSubModel.sub_code, //科目代码
					index_code: curPage.access
				}
				postDataEncry(window.storageKeyName.INTERFACE_ZXKT + '/pub/resMater', {}, tempData, 2, function(data) {
					events.closeWaiting();
					if (data.code == 0) {
						if (data.data.list && data.data.list.length > 0) {
							for(var i = 0; i < data.data.list.length; i++){
								var tempM = data.data.list[i];
								if (i==0) {
									tempM.ischeck = 1;
								} else{
									tempM.ischeck = 0;
								}
							}
							catalogData.resMaterArray = [].concat(data.data.list);
							catalogData.resMaterModel = data.data.list[0];
							// 查询分册
							getResFasc();
						} else {
							catalogData.resMaterArray = [].concat([]);
							catalogData.resFascArray = [].concat([]);
							catalogData.resCatalogsArray = [].concat([]);
							mui.toast('暂无教版');
						}
					} else {
						mui.toast(data.msg);
					}
				});
			}
			
			// 查询分册
			function getResFasc() {
				var tempData = {
					per_code: catalogData.resPerModel.per_code, //学段代码
					sub_code: catalogData.resSubModel.sub_code, //科目代码
					mater_code: catalogData.resMaterModel.mater_code, //教版代码
					index_code: curPage.access
				}
				postDataEncry(window.storageKeyName.INTERFACE_ZXKT + '/pub/resFasc', {}, tempData, 2, function(data) {
					events.closeWaiting();
					if (data.code == 0) {
						if (data.data.list && data.data.list.length > 0) {
							for(var i = 0; i < data.data.list.length; i++){
								var tempM = data.data.list[i];
								if (i==0) {
									tempM.ischeck = 1;
								} else{
									tempM.ischeck = 0;
								}
							}
							catalogData.resFascArray = [].concat(data.data.list);
							catalogData.resFascModel = data.data.list[0];
							// 查询目录
							getResCatalogs();
						} else {
							catalogData.resFascArray = [].concat([]);
							catalogData.resCatalogsArray = [].concat([]);
							mui.toast('暂无分册');
						}
					} else {
						mui.toast(data.msg);
					}
				});
			}
			
			// 查询目录
			function getResCatalogs() {
				var tempData = {
					per_code: catalogData.resPerModel.per_code, //学段代码
					sub_code: catalogData.resSubModel.sub_code, //科目代码
					mater_code: catalogData.resMaterModel.mater_code, //教版代码
					fasc_code: catalogData.resFascModel.fasc_code, //分册代码
					index_code: curPage.access
				}
				postDataEncry(window.storageKeyName.INTERFACE_ZXKT + '/pub/resCatalogs', {}, tempData, 2, function(data) {
					events.closeWaiting();
					if (data.code == 0) {
						if (data.data) {
							catalogData.resCatalogsArray = [].concat(data.data.catalog.children);
						} else {
							catalogData.resCatalogsArray = [].concat([]);
							mui.toast('暂无目录');
						}
					} else {
						mui.toast(data.msg);
					}
				});
			}
		</script>
	</body>

</html>
